input {
  tcp {
    port => 5000
    codec => line { charset => "UTF-8" }
    type => "legacy_system"
  }
}

filter {
  # CSV 형식 파싱: transaction_id,user_id,account_id,amount,merchant_id,timestamp
  csv {
    separator => ","
    columns => ["transaction_id", "user_id", "account_id", "transaction_amount", "merchant_id", "transaction_time"]
    convert => {
      "transaction_amount" => "float"
    }
  }
  
  date {
    match => ["transaction_time", "yyyy-MM-dd HH:mm:ss", "ISO8601"]
    target => "@timestamp"
  }
  
  mutate {
    add_field => { 
      "[@metadata][pipeline]" => "tcp"
      "data_source" => "legacy_system" 
    }
    add_tag => ["legacy_transaction"]
    remove_field => ["message", "host", "port"]
  }
}

output {
  pipeline { 
    send_to => ["enrichment_channel"] 
  }
}